;
; drawline.s -- Bresenham for straight lines
;

	.export	drawLine

	.import	_gfxinstalled
	.import	_nogfx
	.import	_setPixelNoCheck

	.code
	.align	4

	; drawLine(x1: int, y1: int, x2: int, y2: int, color: int)
drawLine:
	ldw	$8,$0,_gfxinstalled
	beq	$8,$0,_nogfx
drawLineNoCheck:
	sub	$29,$29,48
	stw	$25,$29,16
	add	$25,$29,48
	stw	$31,$25,-36
	add	$8,$25,-4
	add	$9,$25,0
	ldw	$9,$9,0
	stw	$9,$8,0
	add	$8,$25,-8
	add	$9,$25,4
	ldw	$9,$9,0
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	add	$8,$25,-12
	add	$9,$25,8
	ldw	$9,$9,0
	add	$10,$25,0
	ldw	$10,$10,0
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-16
	add	$9,$25,12
	ldw	$9,$9,0
	add	$10,$25,4
	ldw	$10,$10,0
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-12
	ldw	$8,$8,0
	add	$9,$0,0
	bge	$8,$9,drawLine0
	add	$8,$25,-16
	ldw	$8,$8,0
	add	$9,$0,0
	bge	$8,$9,drawLine2
	add	$8,$0,0
	add	$9,$25,-12
	ldw	$9,$9,0
	sub	$8,$8,$9
	add	$9,$0,0
	add	$10,$25,-16
	ldw	$10,$10,0
	sub	$9,$9,$10
	bge	$8,$9,drawLine4
	add	$8,$25,-20
	add	$9,$0,0
	add	$10,$25,-16
	ldw	$10,$10,0
	sub	$9,$9,$10
	add	$10,$0,2
	add	$11,$25,-12
	ldw	$11,$11,0
	mul	$10,$10,$11
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-24
	add	$9,$0,0
	add	$10,$0,2
	sub	$9,$9,$10
	add	$10,$25,-16
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-28
	add	$9,$0,2
	add	$10,$25,-12
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
drawLine6:
	add	$8,$25,-8
	ldw	$8,$8,0
	add	$9,$25,12
	ldw	$9,$9,0
	ble	$8,$9,drawLine7
	add	$8,$25,-20
	ldw	$8,$8,0
	add	$9,$0,0
	bgt	$8,$9,drawLine8
	add	$8,$25,-4
	add	$9,$25,-4
	ldw	$9,$9,0
	add	$10,$0,1
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-24
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
drawLine8:
	add	$8,$25,-8
	add	$9,$25,-8
	ldw	$9,$9,0
	add	$10,$0,1
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-28
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	j	drawLine6
drawLine7:
	j	drawLine5
drawLine4:
	add	$8,$25,-20
	add	$9,$0,0
	add	$10,$25,-12
	ldw	$10,$10,0
	sub	$9,$9,$10
	add	$10,$0,2
	add	$11,$25,-16
	ldw	$11,$11,0
	mul	$10,$10,$11
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-24
	add	$9,$0,0
	add	$10,$0,2
	sub	$9,$9,$10
	add	$10,$25,-12
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-28
	add	$9,$0,2
	add	$10,$25,-16
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
drawLine9:
	add	$8,$25,-4
	ldw	$8,$8,0
	add	$9,$25,8
	ldw	$9,$9,0
	ble	$8,$9,drawLine10
	add	$8,$25,-20
	ldw	$8,$8,0
	add	$9,$0,0
	bgt	$8,$9,drawLine11
	add	$8,$25,-8
	add	$9,$25,-8
	ldw	$9,$9,0
	add	$10,$0,1
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-24
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
drawLine11:
	add	$8,$25,-4
	add	$9,$25,-4
	ldw	$9,$9,0
	add	$10,$0,1
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-28
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	j	drawLine9
drawLine10:
drawLine5:
	j	drawLine3
drawLine2:
	add	$8,$0,0
	add	$9,$25,-12
	ldw	$9,$9,0
	sub	$8,$8,$9
	add	$9,$25,-16
	ldw	$9,$9,0
	bge	$8,$9,drawLine12
	add	$8,$25,-20
	add	$9,$25,-16
	ldw	$9,$9,0
	add	$10,$0,2
	add	$11,$25,-12
	ldw	$11,$11,0
	mul	$10,$10,$11
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-24
	add	$9,$0,2
	add	$10,$25,-16
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-28
	add	$9,$0,2
	add	$10,$25,-12
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
drawLine14:
	add	$8,$25,-8
	ldw	$8,$8,0
	add	$9,$25,12
	ldw	$9,$9,0
	bge	$8,$9,drawLine15
	add	$8,$25,-20
	ldw	$8,$8,0
	add	$9,$0,0
	bge	$8,$9,drawLine16
	add	$8,$25,-4
	add	$9,$25,-4
	ldw	$9,$9,0
	add	$10,$0,1
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-24
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
drawLine16:
	add	$8,$25,-8
	add	$9,$25,-8
	ldw	$9,$9,0
	add	$10,$0,1
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-28
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	j	drawLine14
drawLine15:
	j	drawLine13
drawLine12:
	add	$8,$25,-20
	add	$9,$0,0
	add	$10,$25,-12
	ldw	$10,$10,0
	sub	$9,$9,$10
	add	$10,$0,2
	add	$11,$25,-16
	ldw	$11,$11,0
	mul	$10,$10,$11
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-24
	add	$9,$0,0
	add	$10,$0,2
	sub	$9,$9,$10
	add	$10,$25,-12
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-28
	add	$9,$0,0
	add	$10,$0,2
	sub	$9,$9,$10
	add	$10,$25,-16
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
drawLine17:
	add	$8,$25,-4
	ldw	$8,$8,0
	add	$9,$25,8
	ldw	$9,$9,0
	ble	$8,$9,drawLine18
	add	$8,$25,-20
	ldw	$8,$8,0
	add	$9,$0,0
	bge	$8,$9,drawLine19
	add	$8,$25,-8
	add	$9,$25,-8
	ldw	$9,$9,0
	add	$10,$0,1
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-24
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
drawLine19:
	add	$8,$25,-4
	add	$9,$25,-4
	ldw	$9,$9,0
	add	$10,$0,1
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-28
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	j	drawLine17
drawLine18:
drawLine13:
drawLine3:
	j	drawLine1
drawLine0:
	add	$8,$25,-16
	ldw	$8,$8,0
	add	$9,$0,0
	bge	$8,$9,drawLine20
	add	$8,$25,-12
	ldw	$8,$8,0
	add	$9,$0,0
	add	$10,$25,-16
	ldw	$10,$10,0
	sub	$9,$9,$10
	bge	$8,$9,drawLine22
	add	$8,$25,-20
	add	$9,$0,0
	add	$10,$25,-16
	ldw	$10,$10,0
	sub	$9,$9,$10
	add	$10,$0,2
	add	$11,$25,-12
	ldw	$11,$11,0
	mul	$10,$10,$11
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-24
	add	$9,$0,0
	add	$10,$0,2
	sub	$9,$9,$10
	add	$10,$25,-16
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-28
	add	$9,$0,0
	add	$10,$0,2
	sub	$9,$9,$10
	add	$10,$25,-12
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
drawLine24:
	add	$8,$25,-8
	ldw	$8,$8,0
	add	$9,$25,12
	ldw	$9,$9,0
	ble	$8,$9,drawLine25
	add	$8,$25,-20
	ldw	$8,$8,0
	add	$9,$0,0
	bgt	$8,$9,drawLine26
	add	$8,$25,-4
	add	$9,$25,-4
	ldw	$9,$9,0
	add	$10,$0,1
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-24
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
drawLine26:
	add	$8,$25,-8
	add	$9,$25,-8
	ldw	$9,$9,0
	add	$10,$0,1
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-28
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	j	drawLine24
drawLine25:
	j	drawLine23
drawLine22:
	add	$8,$25,-20
	add	$9,$25,-12
	ldw	$9,$9,0
	add	$10,$0,2
	add	$11,$25,-16
	ldw	$11,$11,0
	mul	$10,$10,$11
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-24
	add	$9,$0,2
	add	$10,$25,-12
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-28
	add	$9,$0,2
	add	$10,$25,-16
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
drawLine27:
	add	$8,$25,-4
	ldw	$8,$8,0
	add	$9,$25,8
	ldw	$9,$9,0
	bge	$8,$9,drawLine28
	add	$8,$25,-20
	ldw	$8,$8,0
	add	$9,$0,0
	bgt	$8,$9,drawLine29
	add	$8,$25,-8
	add	$9,$25,-8
	ldw	$9,$9,0
	add	$10,$0,1
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-24
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
drawLine29:
	add	$8,$25,-4
	add	$9,$25,-4
	ldw	$9,$9,0
	add	$10,$0,1
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-28
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	j	drawLine27
drawLine28:
drawLine23:
	j	drawLine21
drawLine20:
	add	$8,$25,-12
	ldw	$8,$8,0
	add	$9,$25,-16
	ldw	$9,$9,0
	bge	$8,$9,drawLine30
	add	$8,$25,-20
	add	$9,$25,-16
	ldw	$9,$9,0
	add	$10,$0,2
	add	$11,$25,-12
	ldw	$11,$11,0
	mul	$10,$10,$11
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-24
	add	$9,$0,2
	add	$10,$25,-16
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-28
	add	$9,$0,0
	add	$10,$0,2
	sub	$9,$9,$10
	add	$10,$25,-12
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
drawLine32:
	add	$8,$25,-8
	ldw	$8,$8,0
	add	$9,$25,12
	ldw	$9,$9,0
	bge	$8,$9,drawLine33
	add	$8,$25,-20
	ldw	$8,$8,0
	add	$9,$0,0
	bge	$8,$9,drawLine34
	add	$8,$25,-4
	add	$9,$25,-4
	ldw	$9,$9,0
	add	$10,$0,1
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-24
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
drawLine34:
	add	$8,$25,-8
	add	$9,$25,-8
	ldw	$9,$9,0
	add	$10,$0,1
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-28
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	j	drawLine32
drawLine33:
	j	drawLine31
drawLine30:
	add	$8,$25,-20
	add	$9,$25,-12
	ldw	$9,$9,0
	add	$10,$0,2
	add	$11,$25,-16
	ldw	$11,$11,0
	mul	$10,$10,$11
	sub	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-24
	add	$9,$0,2
	add	$10,$25,-12
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-28
	add	$9,$0,0
	add	$10,$0,2
	sub	$9,$9,$10
	add	$10,$25,-16
	ldw	$10,$10,0
	mul	$9,$9,$10
	stw	$9,$8,0
drawLine35:
	add	$8,$25,-4
	ldw	$8,$8,0
	add	$9,$25,8
	ldw	$9,$9,0
	bge	$8,$9,drawLine36
	add	$8,$25,-20
	ldw	$8,$8,0
	add	$9,$0,0
	bge	$8,$9,drawLine37
	add	$8,$25,-8
	add	$9,$25,-8
	ldw	$9,$9,0
	add	$10,$0,1
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-24
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
drawLine37:
	add	$8,$25,-4
	add	$9,$25,-4
	ldw	$9,$9,0
	add	$10,$0,1
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-20
	add	$9,$25,-20
	ldw	$9,$9,0
	add	$10,$25,-28
	ldw	$10,$10,0
	add	$9,$9,$10
	stw	$9,$8,0
	add	$8,$25,-4
	ldw	$8,$8,0
	stw	$8,$29,0
	add	$8,$25,-8
	ldw	$8,$8,0
	stw	$8,$29,4
	add	$8,$25,16
	ldw	$8,$8,0
	stw	$8,$29,8
	jal	_setPixelNoCheck
	j	drawLine35
drawLine36:
drawLine31:
drawLine21:
drawLine1:
	ldw	$31,$25,-36
	ldw	$25,$29,16
	add	$29,$29,48
	jr	$31
